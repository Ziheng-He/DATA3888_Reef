---
title: "Reef P2 - Report"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
date: '2022-05-25'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#libraries
library(tidyr)
library(dplyr)
library(tidyverse)
library(maps)
library(ggplot2)
library(sjPlot)
library(cvTools)
library(ozmaps)
library(vcdExtra)
library(corrplot)
library(RColorBrewer)
library(caret)
```

```{r read_data, echo = FALSE, warning = FALSE, message = FALSE, include = FALSE}
# Reading data
setwd('..')
new_reef = read_csv("./Data/lr_version_merged_mean.csv")

# Cleaning names
data = new_reef %>% janitor::clean_names()

## removing NA data entries
data <- na.omit(data)

## changing date to date
# data$date <- as.Date(data$date, format = "%d-%b-%y")

# Convert bleached
data$bleached <- ifelse(data$average_bleaching > 0, "1", "0")
# 0 = not bleached
# 1 = bleached
data %>% count(bleached)

# Convert to numeric
data$bleached <- as.factor(data$bleached)

```

# Executive Summary


We know that warmer ocean temperatures linked to climate change are the primary factors in coral bleaching. In the interdisciplinary project with the MARS students, we identified an interesting correlation between ocean currents, thermal activity, and its effect on coral. However, upon further research, conflicting literature states that, while ocean currents can transport excess nutrients that make corals more susceptible to bleaching (DeCarlo et al., 2020), stronger currents can also flush out toxins aiding in the process of coral recovery (Nakamura et al., 2003).

Our team looked at the relationship between average ocean current velocity and the effect it has on the bleaching of corals in the Great Barrier Reef. In doing so, we can confirm our hypothesis that ocean currents do have a significant impact on coral bleaching. The overall aim was to implement different classification models on Python Dash to enable marine scientists to predict and visualize the chance of coral bleaching given specific parameters within the Great Barrier Reef. This will allow further attention on areas where corals are more susceptible to stressing factors.

# Method

```
- Communicate the results to a general scientist, note this is different to the target audience of your product. 
- A clear description of your innovation and approach to the scientific problem.
- Include all relevant data summaries only.
- What is your approach and which tools are used and why? 
- What are the key findings? and use figures to illustrate the results.
- How robust and generalizable is your finding or your product?
- Main code and technical details of your approach in the appendix.
```
The classification methods used are logistic regression (LR), random forest (RF), support vector machine (SVM).
Accuracy and feature selection were analyzed to determine which classifiers and features were best for classification of reef bleaching. After multiple evaluations, the random forest classifier is the most accurate for judging whether coral reefs are bleached. At the same time, the three models analyze the characteristic variables to determine the main variables that lead to coral reef bleaching. The motivation for the team to implement the project is that it enables marine scientists to predict and visualize the likelihood of coral bleaching based on specific parameters of the Great Barrier Reef. This will allow further attention to areas where corals are more vulnerable to stressors. Because Coral reefs are the most diverse marine ecosystems in the world. They provide billions of dollars of economic value by Coastal protection, food, tourism and medicine from the sea. Coral bleaching leads to coral morbidity and mortality, which leads to coral loss. Global atmosphere-ocean circulation models predict that few coral reefs will survive in the ocean for the next 80 years.


### Data Collection 

```
Clear description of the approach in data collection, developed model, the evaluation strategies from a data-science perspective. Here we refer to all types of evaluation metrics including graphical, qualitative and quantitative metric.

Reef project - Clear description of the approach in data collection to address appropriate research questions, developed model, the evaluation strategies from a marine science perspective,
```
The data used in this project is merged from the DATA3888 Reef Check data as well as ocean current netCDF files taken from AIMS (Australian Institute of Marine Science). The ocean data was collated from the years 2017 to 2022? by month. 

The data used in this project was merged from DATA3888 Reef Check data and ocean current netCDF files from AIMS (Australian Institute of Marine Science). Ocean data is from 2010 to 2015. By using mean_cur as the data for ocean currents, most of the fluctuations of the tidal currents are averaged out, allowing some of the large scale current flow patterns to be seen.

Data Collection
When merging data sets, it can be found that latitude and longitude cannot be accurately matched. Using past data and Jackson's guidance, the team chose to divide the latitude and longitude of each observation into a range rather than an exact value. At the same time, two methods were adopted when merging the data sets, thus obtaining two data sets. A small amount of data is suitable for logistic regression, and a large amount of data is suitable for machine learning, which can help the team get a more accurate model.

Data Prepossessing
Since the variables used to judge whether coral reefs are bleached in the dataset have the most 0 values, other values are too few. For better classification, the team chose to convert this variable to a binary variable with a threshold of 0 (Average_bleaching = 0 is "bleached", and Average_bleaching > 0 is "not bleached"). And in regression, we choose to stay the same.


etc.

Figure 1

### Models

We tested our merged data on 3 classification models - Logistic Regression, Support Vector Machine and Random Forest. With average bleaching as the response model, we used the same variables for our 3 models. This included the variables:

- ClimSST (Climatological Sea Surface Temperature)
- Temperature_Kelvin (temperature in kelvin)
- Temperature_Kelvin_Standard_Deviation
- SSTA_Frequency (Sea Surface Temperature Anomaly)
- SSTA_Frequency_Standard_Deviation
- TSA_Frequency_Standard_Deviation
- mean_cur (mean ocean current velocity)

### Logistic Regression Model - Kitty

We used a Logistic Regression Model to predict the outcome of bleaching against our chosen predictor variables from our merged data. Focusing on whether ocean current velocity would significantly impact the susceptibility of coral to bleaching, we take a closer look at the `mean_cur` value. Our logistic regression model is also used to model the binary outcome by returning an estimate of the probability of coral bleaching occurring between 0 and 1. 

- interpretation of pvalue, mean curr or any other variables significant
- coefficients



### Support Vector Machine - Oliver
In the SVM model,  the accuracy of the model is 83%. Through the linear kernel function, the coefficient between bleaching and current velocity is -1.89e to the power of 5, which indicates that there is negatively correlated between them, although they are correlated but too weakï¼Œso we can say there is no significance between coral bleaching and  ocean currents. 

Accuracy: 0.83
Interpretability: the coefficient between bleaching and current velocity is -0.0000189
no significance in coral bleaching related to ocean current velocity. 
Scalability: <1 second per 10%, 50%, 70% and 100% sample of data.


### Random Forest - Zhenyu


### Evaluation strategies

Figure 2


# Results

```
A clear justification of the final approach based on the proposed evaluation strategies. Ensuring multiple evaluation strategies are used.

A clear description of the deployment process. An engaging and clear illustration of the product (games, shiny app, learning device etc) with a discussion of concepts from multiple disciplines.
```
The model evaluations showed our Random Forest model had the most accuracy in classifying whether coral bleaching would occur with from our chosen variables. With an overall accuracy of 87%, we have decided to implement this model as part of our final product. 


python dash stuff..

### Innovation

blahlafafbla

# Discussion

```
Discussion of potential shortcomings or issues associated with the development process or the product with reference to both disciplines. Identification of future work or improvement in both disciplines. Conclusion adequately summarises the project and identification of future work.
```

### Limitations
... blah blah only average ocean velocity not direction etc
- only the GBF
- issues
- only test merged data on 3 classification models, Random Forest model had the most accuracy in classifying whether coral bleaching would occur with from our chosen variables. With an overall accuracy of 87%, however we cannot guarantee that Random Forest model is the best fitting model .
ocean currents can transport excess nutrients that make corals more susceptible to bleaching , stronger currents can also flush out toxins aiding in the process of coral recovery . But we only assume a relationship between average ocean current velocity and the effect it has on the bleaching of corals In the Great Barrier Reef, we can control the ocean currents within a certain range. When the collected ocean currents exceed a certain value, we can discard that part of the ocean currents data, and perhaps get a more accurate conclusion.

### Future work

# Conclusion

# Appendix

### Figure 1 {.tabset}

Here, we have graphed an initial look at our data.

#### Coral bleaching
```{r, warning = FALSE, message = FALSE}
world <- map_data("world")
oz_states <- ozmap_states

ggplot(oz_states) + geom_sf() + coord_sf() +
  geom_point(
    data = data,
    aes(reef_longitude, reef_latitude, colour = bleached),
    alpha = 0.7) + ggtitle("Amount of coral points bleached vs not bleached in the GBF") + 
  ylab("Latitude") + xlab("Longitude") + scale_colour_manual(labels = c("not bleached", "bleached"), values = c("red", "blue"))
```

#### Average coral bleaching
```{r}
ggplot(oz_states) + geom_sf() + coord_sf() +
  geom_point(
    data = data,
    aes(reef_longitude, reef_latitude, size = average_bleaching, colour = average_bleaching),
    alpha = 0.7) + ggtitle("Average coral bleaching along the GBF") + 
  ylab("Latitude") + xlab("Longitude") 

```


# Student contributions  
(50-200 words)

# References

- https://www.barrierreef.org/the-reef/threats/coral-bleaching 
- https://oceanservice.noaa.gov/facts/coral_bleach.html 
- DeCarlo ...
- Nakamura ...

```
# Presentation
- Correct grammar
- All figures and tables captioned, axes, headings, legends
- Only show necessary figures (Appendix)
```

